<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Kingbbode | Spring Boot에서 Redis 사용하기</title>
  <meta name="description" content="Redis를 쓰고 있으면서도 잘 몰랐습니다. 그래서 정리했습니다!">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <meta property="og:title" content="Spring Boot에서 Redis 사용하기">
  <meta property="og:type" content="website">
  <meta property="og:url" content="https://kingbbode.github.io/posts/spinrg-boot-redis">
  <meta property="og:description" content="Redis를 쓰고 있으면서도 잘 몰랐습니다. 그래서 정리했습니다!">
  <meta property="og:site_name" content="Kingbbode">
  <meta property="og:image" content="https://kingbbode.github.io/assets/og-image.jpg">
  <meta name="twitter:card" content="summary">
  <meta name="twitter:url" content="https://kingbbode.github.io/posts/spinrg-boot-redis">
  <meta name="twitter:title" content="Spring Boot에서 Redis 사용하기">
  <meta name="twitter:description" content="Redis를 쓰고 있으면서도 잘 몰랐습니다. 그래서 정리했습니다!">
  <meta name="twitter:image" content="https://kingbbode.github.io/assets/og-image.jpg">

  <link rel="apple-touch-icon" href="/assets/apple-touch-icon.png">
  <link href="https://kingbbode.github.io/feed.xml" type="application/rss+xml" rel="alternate" title="Kingbbode Last 10 blog posts" />

  
    <link type="text/css" rel="stylesheet" href="/assets/dark.css">
  
</head>

<body>
  <main role="main">
    <div class="grid grid-centered">
      <div class="grid-cell">
        <nav class="header-nav reveal">
  <a href="/" class="header-logo" title="Kingbbode">Kingbbode</a>
  <ul class="header-links">
    
      <li>
        <a href="/about" title="About me">
          <span class="icon icon-android-person"></span>
        </a>
      </li>
    
    
      <li>
        <a href="https://twitter.com/kingbbode" target="_blank" title="Twitter">
          <span class="icon icon-social-twitter"></span>
        </a>
      </li>
    
    
      <li>
        <a href="https://www.facebook.com/iwannaknowcoding" target="_blank" title="Facebook">
          <span class="icon icon-social-facebook"></span>
        </a>
      </li>
    
    
      <li>
        <a href="https://github.com/kingbbode" target="_blank" title="GitHub">
          <span class="icon icon-social-github"></span>
        </a>
      </li>
    
    
      <li>
        <a href="https://dribbble.com/kingbbode" target="_blank" title="Dribbble">
          <span class="icon icon-social-dribbble-outline"></span>
        </a>
      </li>
    
    
    
    
    
      <li>
        <a href="mailto:kingbbode@gmail.com" title="Email">
          <span class="icon icon-at"></span>
        </a>
      </li>
    
    
      <li>
        <a href="/feed.xml" target="_blank" title="RSS">
          <span class="icon icon-social-rss"></span>
        </a>
      </li>
    
  </ul>
</nav>

        <article class="article reveal">
          <header class="article-header">
            <h1>Spring Boot에서 Redis 사용하기</h1>
            <p>Redis를 쓰고 있으면서도 잘 몰랐습니다. 그래서 정리했습니다!</p>
            <div class="article-list-footer">
              <span class="article-list-date">
                December 4, 2016
              </span>
              <span class="article-list-divider">-</span>
              <span class="article-list-minutes">
                
                
                  7 minute read
                
              </span>
              <span class="article-list-divider">-</span>
              <div class="article-list-tags">
                
                  <a href="/tag/spring boot">spring boot</a>
                
                  <a href="/tag/redis">redis</a>
                
                  <a href="/tag/nosql">nosql</a>
                
              </div>
            </div>
          </header>

          <div class="article-content">
            <h2 id="redis란">Redis란?</h2>

<p><img src="/images/2016/2016_12_04_Spring_Boot_Redis/redis.png" alt="Redis" /></p>

<ul>
  <li><code class="highlighter-rouge">Remote Dictionary Server</code>의 약자</li>
  <li>오픈 소스 소프트웨어</li>
  <li><code class="highlighter-rouge">휘발성</code>이면서 <code class="highlighter-rouge">영속성</code>을 가진 <code class="highlighter-rouge">key-value</code> 저장소</li>
</ul>

<h3 id="redis는-nosql">Redis는 NoSQL</h3>

<p><strong>NoSQL</strong>은 데이터 간의 관계를 정의하지 않고 고정된 스키마를 갖지 않는 새로운 형태의 데이터베이스로서, <strong>관계형 데이터베이스(RDBMS)를 경량화한 데이터베이스</strong> 입니다. 관계형 데이터베이스의 특징 을 제거하고 만들어진 다른 모든 형태의 DBMS를 칭하 기도 하며, SQL 계열 질의어를 사용할 수 있다는 사실 을 강조한다는 면에서 “Not Only SQL”로 불리기도 합니다.</p>

<p><em>Redis는 이러한 NoSQL의 종류 중 하나입니다.</em></p>

<h3 id="데이터-모델">데이터 모델</h3>

<p>NoSQL이 가지고 있는 대표적인 데이터 모델은 아래와 같습니다.</p>

<ul>
  <li>Key-Value
    <ul>
      <li>하나의 Key에 하나의 Value를 갖는 데이터 모델</li>
      <li>Key로만 접근 가능</li>
    </ul>
  </li>
  <li>Column
    <ul>
      <li>하나의 Key에 여러개의 Value를 갖을 수 있는 데이터 모델</li>
      <li>중첩된 HashMap 구조</li>
    </ul>
  </li>
  <li>Document
    <ul>
      <li>Value가 Json이나 XML Document를 갖는 데이터 모델</li>
      <li>Value의 일부로 질의하고 일부만 가져올 수 있음</li>
    </ul>
  </li>
  <li>Graph
    <ul>
      <li>관계에 특화된 모델</li>
      <li>노드와 간선에 대한 정보</li>
    </ul>
  </li>
</ul>

<p><em>이 중 Redis는 Key-Value 데이터 모델을 사용합니다. <br />단순한 형태의 Key-Value 방식으로 빠른 속도를 지원할 수 있습니다.</em></p>

<h3 id="데이터-타입">데이터 타입</h3>

<p>Redis는 key-value 데이터 모델에서 Value가 가질 수 있는 자료 구조를 제공합니다.</p>

<p>제공되는 자료구조를 아래와 같습니다.</p>

<ul>
  <li>String
    <ul>
      <li>Command Docs : http://redis.io/commands#string</li>
      <li>Text, 숫자 등 일반적인 Value</li>
    </ul>
  </li>
  <li>Set
    <ul>
      <li>Command Docs : http://redis.io/commands#set</li>
      <li>Value가 Set 자료구조가 되므로, 하나의 Key 값에 여러 값을 Set 자료구조를 통해 저장 가능</li>
      <li>Set간의 집합 연산을 제공</li>
    </ul>
  </li>
  <li>Sorted Set
    <ul>
      <li>Command Docs : http://www.redis.io/commands#sorted_set</li>
      <li>score라는 필드가 추가되어 정렬의 기준이 됨.</li>
      <li>score를 통해 질의 가능</li>
      <li>그 외에는 위의 Set과 같음</li>
    </ul>
  </li>
  <li>
    <p>Hashes</p>

    <ul>
      <li>Command Docs : https://redis.io/commands#hash</li>
      <li>Value가 Map 자료구조와 같은 Key/Value 형태가 됨
        <ul>
          <li>하나의 Key에 여러개의 필드를 갖는 구조가 됨</li>
        </ul>
      </li>
    </ul>
  </li>
  <li>
    <p>List</p>

    <ul>
      <li>Command Docs : https://redis.io/commands#list</li>
      <li>Value가 linkedList 자료구조가 됨
        <ul>
          <li>Push/Pop 연산 가능</li>
          <li>index 활용 질의 가능</li>
        </ul>
      </li>
    </ul>
  </li>
</ul>

<h3 id="휘발성">휘발성</h3>

<p>스티븐 옌은 자신의 블로그의 글 “NoSQL is a Horseless Carriage”에서 Redis를 Store가 아닌 Cache로 구분했습니다.<a href="http://highscalability.com/blog/2009/11/5/a-yes-for-a-nosql-taxonomy.html">(A Yes for a NoSQL Taxonomy 참고)</a></p>

<p><em>Reids는 디스크 기반이 아닌 메모리에 데이터를 read/write하는 in-memory 솔루션이기 때문입니다.</em></p>

<p>메모리 기반이기 때문에 갖을 수 있는 장점은 아래와 같습니다.</p>

<ul>
  <li>메모리에 데이터를 read/write 하기 때문에 매우 빠른 속도를 보장할 수 있습니다.</li>
  <li>모든 데이타가 메모리 안에 있기 때문에 캐시 관점에서 매우 유용합니다.</li>
  <li>Cache 방식을 통한 DB 부하 감소</li>
</ul>

<h3 id="영속성">영속성</h3>

<p>레디스는 지속성을 보장하기 위해 데이터를 DISK에 저장할 수 있습니다. 서버가 내려가더라도 DISK에 저장된 데이터를 읽어서 메모리에 로딩을 합니다.</p>

<p>데이터를 DISK에 저장하는 방식은 크게 두 가지 방식이 있습니다.</p>

<ul>
  <li>snapshotting (RDB) 방식
    <ul>
      <li>순간적으로 메모리에 있는 내용을 DISK에 전체를 옮겨 담는 방식</li>
    </ul>
  </li>
  <li>AOF(Append On File) 방식
    <ul>
      <li>redis의 모든 write/update 연산 자체를 모두 log 파일에 기록하는 형태</li>
    </ul>
  </li>
</ul>

<hr />

<h2 id="spring-boot-시작">Spring Boot 시작</h2>

<h3 id="dependency">Dependency</h3>

<blockquote>
  <p>build.gradle</p>
</blockquote>

<div class="highlighter-rouge"><pre class="highlight"><code>compile("org.springframework.data:spring-data-redis:1.7.2.RELEASE")
compile("redis.clients:jedis:2.8.1")
</code></pre>
</div>

<ul>
  <li>
    <p>spring-data-redis : 스프링에서 공식 지원하는 Dependency로 Redis Client와 연동 가능한 높은 레벨의 <code class="highlighter-rouge">RedisTemplate</code> 추상화를 제공합니다.</p>
  </li>
  <li>
    <p>jedis : 가장 많이 사용되고 있는 Java Client로 가장 활발한 오픈소스이며, 레디스에서 공식 추천하고 있는 Client 중 하나입니다. <a href="http://redis.io/clients#java">[참고]</a></p>
  </li>
</ul>

<h3 id="java-configuration">Java Configuration</h3>

<blockquote>
  <p>RedisConfig.java</p>
</blockquote>

<div class="language-java highlighter-rouge"><pre class="highlight"><code><span class="nd">@Configuration</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">RedisConfig</span> <span class="o">{</span>
    <span class="nd">@Bean</span>
    <span class="kd">public</span> <span class="n">JedisConnectionFactory</span> <span class="nf">jedisConnectionFactory</span><span class="o">()</span> <span class="o">{</span>

        <span class="n">JedisConnectionFactory</span> <span class="n">jedisConnectionFactory</span> <span class="o">=</span> <span class="k">new</span> <span class="n">JedisConnectionFactory</span><span class="o">();</span>
        <span class="n">jedisConnectionFactory</span><span class="o">.</span><span class="na">setHostName</span><span class="o">(</span><span class="s">"xxx.xxx.xxx.xxx"</span><span class="o">);</span>
        <span class="n">jedisConnectionFactory</span><span class="o">.</span><span class="na">setPort</span><span class="o">(</span><span class="mi">6379</span><span class="o">);</span>
        <span class="n">jedisConnectionFactory</span><span class="o">.</span><span class="na">setTimeout</span><span class="o">(</span><span class="mi">0</span><span class="o">);</span>
        <span class="n">jedisConnectionFactory</span><span class="o">.</span><span class="na">setUsePool</span><span class="o">(</span><span class="kc">true</span><span class="o">);</span>

        <span class="k">return</span> <span class="n">jedisConnectionFactory</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="nd">@Bean</span>
    <span class="kd">public</span> <span class="n">StringRedisTemplate</span> <span class="nf">redisTemplate</span><span class="o">()</span> <span class="o">{</span>
        <span class="n">StringRedisTemplate</span> <span class="n">stringRedisTemplate</span> <span class="o">=</span> <span class="k">new</span> <span class="n">StringRedisTemplate</span><span class="o">();</span>
        <span class="n">stringRedisTemplate</span><span class="o">.</span><span class="na">setConnectionFactory</span><span class="o">(</span><span class="n">jedisConnectionFactory</span><span class="o">());</span>
        <span class="k">return</span> <span class="n">stringRedisTemplate</span><span class="o">;</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre>
</div>

<p>Spring Data에서 제공하는 만큼 기존 JDBC 설정 지원과 거의 유사함을 볼 수 있습니다.</p>

<h4 id="operations">Operations</h4>

<p>Operation은 사용할 데이터 타입에 따라 다르게 사용해야 합니다. Operation들은 <code class="highlighter-rouge">@Resources</code> 어노테이션을 통해 선언해놓은 <code class="highlighter-rouge">RedisTemplate</code>로부터 주입 받을 수 있습니다.</p>

<p><strong>String</strong></p>

<div class="language-java highlighter-rouge"><pre class="highlight"><code><span class="nd">@Resource</span><span class="o">(</span><span class="n">name</span><span class="o">=</span><span class="s">"redisTemplate"</span><span class="o">)</span>
<span class="kd">private</span> <span class="n">ValueOperations</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span> <span class="n">String</span><span class="o">&gt;</span> <span class="n">valueOperations</span><span class="o">;</span>
</code></pre>
</div>

<p><strong>Set</strong></p>

<div class="language-java highlighter-rouge"><pre class="highlight"><code><span class="nd">@Resource</span><span class="o">(</span><span class="n">name</span><span class="o">=</span><span class="s">"redisTemplate"</span><span class="o">)</span>
<span class="kd">private</span> <span class="n">SetOperations</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span> <span class="n">String</span><span class="o">&gt;</span> <span class="n">setOperations</span><span class="o">;</span>
</code></pre>
</div>

<p><strong>Sorted Set</strong></p>

<div class="language-java highlighter-rouge"><pre class="highlight"><code><span class="nd">@Resource</span><span class="o">(</span><span class="n">name</span><span class="o">=</span><span class="s">"redisTemplate"</span><span class="o">)</span>
<span class="kd">private</span> <span class="n">ZSetOperations</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span> <span class="n">String</span><span class="o">&gt;</span> <span class="n">zSetOperations</span><span class="o">;</span>
</code></pre>
</div>

<p><strong>Hashes</strong></p>

<div class="language-java highlighter-rouge"><pre class="highlight"><code><span class="nd">@Resource</span><span class="o">(</span><span class="n">name</span><span class="o">=</span><span class="s">"redisTemplate"</span><span class="o">)</span>
<span class="kd">private</span> <span class="n">HashOperations</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span> <span class="n">String</span><span class="o">,</span> <span class="n">String</span><span class="o">&gt;</span> <span class="n">hashOperations</span><span class="o">;</span>
</code></pre>
</div>

<p><strong>Hashes</strong></p>

<div class="language-java highlighter-rouge"><pre class="highlight"><code><span class="nd">@Resource</span><span class="o">(</span><span class="n">name</span><span class="o">=</span><span class="s">"redisTemplate"</span><span class="o">)</span>
<span class="kd">private</span> <span class="n">ListOperations</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span> <span class="n">String</span><span class="o">&gt;</span> <span class="n">listOperations</span><span class="o">;</span>
</code></pre>
</div>

<h4 id="operation-사용-예제">Operation 사용 예제</h4>

<p>적절하지는 않지만, 다양한 데이터 타입을 사용하는 간단한 예제를 만들어보았습니다.</p>

<p>Redis에 간단한 자기소개 정보를 저장해두고, 특정 사건이 발생함에 따라 변하는 변화를 Redis Operation으로 풀어보았습니다~</p>

<p>특정 사건은 선임의 이직!</p>

<p><img src="/images/2016/2016_12_04_Spring_Boot_Redis/bye.gif" alt="bye" /></p>

<blockquote>
  <p>SpringBootRedisApplicationTests.java</p>
</blockquote>

<div class="language-java highlighter-rouge"><pre class="highlight"><code><span class="nd">@RunWith</span><span class="o">(</span><span class="n">SpringRunner</span><span class="o">.</span><span class="na">class</span><span class="o">)</span>
<span class="nd">@SpringBootTest</span><span class="o">(</span><span class="n">classes</span> <span class="o">=</span> <span class="n">SpringBootRedisApplication</span><span class="o">.</span><span class="na">class</span><span class="o">)</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">SpringBootRedisApplicationTests</span> <span class="o">{</span>

    <span class="nd">@Resource</span><span class="o">(</span><span class="n">name</span><span class="o">=</span><span class="s">"redisTemplate"</span><span class="o">)</span>
    <span class="kd">private</span> <span class="n">ValueOperations</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span> <span class="n">String</span><span class="o">&gt;</span> <span class="n">valueOperations</span><span class="o">;</span>

    <span class="nd">@Resource</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"redisTemplate"</span><span class="o">)</span>
    <span class="kd">private</span> <span class="n">ListOperations</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span> <span class="n">String</span><span class="o">&gt;</span> <span class="n">listOperations</span><span class="o">;</span>

    <span class="nd">@Resource</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"redisTemplate"</span><span class="o">)</span>
    <span class="kd">private</span> <span class="n">HashOperations</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span> <span class="n">String</span><span class="o">,</span> <span class="n">String</span><span class="o">&gt;</span> <span class="n">hashOperations</span><span class="o">;</span>

    <span class="nd">@Resource</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"redisTemplate"</span><span class="o">)</span>
    <span class="kd">private</span> <span class="n">SetOperations</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span> <span class="n">String</span><span class="o">&gt;</span> <span class="n">setOperations</span><span class="o">;</span>

    <span class="nd">@Resource</span><span class="o">(</span><span class="n">name</span><span class="o">=</span><span class="s">"redisTemplate"</span><span class="o">)</span>
    <span class="kd">private</span> <span class="n">ZSetOperations</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span> <span class="n">String</span><span class="o">&gt;</span> <span class="n">zSetOperations</span><span class="o">;</span>
</code></pre>
</div>

<p>테스트가 아니라 간단히 예제를 보여줄 예정이여서 <code class="highlighter-rouge">Application</code>의 <code class="highlighter-rouge">Config</code>를 그대로 사용하려고 합니다.</p>

<h4 id="data-삽입">Data 삽입</h4>

<div class="language-java highlighter-rouge"><pre class="highlight"><code><span class="nd">@Before</span>
<span class="kd">public</span> <span class="kt">void</span> <span class="nf">init</span><span class="o">()</span> <span class="o">{</span>
    <span class="c1">//list put</span>
    <span class="n">listOperations</span><span class="o">.</span><span class="na">rightPush</span><span class="o">(</span><span class="s">"test:task"</span><span class="o">,</span> <span class="s">"자기소개"</span><span class="o">);</span>
    <span class="n">listOperations</span><span class="o">.</span><span class="na">rightPush</span><span class="o">(</span><span class="s">"test:task"</span><span class="o">,</span> <span class="s">"취미소개"</span><span class="o">);</span>
    <span class="n">listOperations</span><span class="o">.</span><span class="na">rightPush</span><span class="o">(</span><span class="s">"test:task"</span><span class="o">,</span> <span class="s">"소망소개"</span><span class="o">);</span>
    <span class="n">listOperations</span><span class="o">.</span><span class="na">rightPush</span><span class="o">(</span><span class="s">"test:task"</span><span class="o">,</span> <span class="s">"선임이직"</span><span class="o">);</span>
    <span class="c1">//hash put</span>
    <span class="n">hashOperations</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">"test:user:kingbbode"</span><span class="o">,</span> <span class="s">"name"</span><span class="o">,</span> <span class="s">"권뽀대"</span><span class="o">);</span>
    <span class="n">hashOperations</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">"test:user:kingbbode"</span><span class="o">,</span> <span class="s">"age"</span><span class="o">,</span> <span class="s">"28"</span><span class="o">);</span>
    <span class="c1">//set put</span>
    <span class="n">setOperations</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="s">"test:user:kingbbode:hobby"</span><span class="o">,</span> <span class="s">"개발"</span><span class="o">);</span>
    <span class="n">setOperations</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="s">"test:user:kingbbode:hobby"</span><span class="o">,</span> <span class="s">"잠"</span><span class="o">);</span>
    <span class="n">setOperations</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="s">"test:user:kingbbode:hobby"</span><span class="o">,</span> <span class="s">"옷 구경"</span><span class="o">);</span>
    <span class="c1">//zset</span>
    <span class="n">zSetOperations</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="s">"test:user:kingbbode:wish"</span><span class="o">,</span> <span class="s">"배포한 것에 장애없길"</span><span class="o">,</span> <span class="mi">1</span><span class="o">);</span>
    <span class="n">zSetOperations</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="s">"test:user:kingbbode:wish"</span><span class="o">,</span> <span class="s">"배포한거 아니여도 장애없길"</span><span class="o">,</span> <span class="mi">2</span><span class="o">);</span>
    <span class="n">zSetOperations</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="s">"test:user:kingbbode:wish"</span><span class="o">,</span> <span class="s">"경력직 채용"</span><span class="o">,</span> <span class="mi">3</span><span class="o">);</span>
    <span class="n">zSetOperations</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="s">"test:user:kingbbode:wish"</span><span class="o">,</span> <span class="s">"잘자기"</span><span class="o">,</span> <span class="mi">4</span><span class="o">);</span>
<span class="o">}</span>
</code></pre>
</div>

<p><code class="highlighter-rouge">List</code>는 <code class="highlighter-rouge">Push</code>를 통하여 데이터를 저장합니다. push에는 leftPush와 rightPush가 있습니다. Stack이나 Queue로 활용 가능합니다.</p>

<p><code class="highlighter-rouge">Hash</code>는 Map 자료형과 사용이 거의 비슷합니다. <code class="highlighter-rouge">key-field-value</code>를 작성하여 데이터를 삽입합니다.</p>

<p><code class="highlighter-rouge">Set</code>은 <code class="highlighter-rouge">같은 Key에 여러 Value</code>를 작성할 수 있습니다.</p>

<p><code class="highlighter-rouge">ZSet</code>은 <code class="highlighter-rouge">Value에 Score를 포함</code>하여 데이터를 삽입하였습니다.</p>

<p><em>모두 네이밍을 통해서 알만한 메서드를 operation에서 제공해주고 있습니다.</em></p>

<h4 id="데이터-조회">데이터 조회</h4>

<div class="language-java highlighter-rouge"><pre class="highlight"><code><span class="nd">@Test</span>
<span class="kd">public</span> <span class="kt">void</span> <span class="nf">redisTest1</span><span class="o">()</span> <span class="o">{</span>
    <span class="n">String</span> <span class="n">task</span> <span class="o">=</span> <span class="n">listOperations</span><span class="o">.</span><span class="na">leftPop</span><span class="o">(</span><span class="s">"test:task"</span><span class="o">);</span>
    <span class="n">StringBuilder</span> <span class="n">stringBuilder</span> <span class="o">=</span> <span class="k">new</span> <span class="n">StringBuilder</span><span class="o">();</span>
    <span class="k">while</span> <span class="o">(</span><span class="n">task</span> <span class="o">!=</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">switch</span> <span class="o">(</span><span class="n">task</span><span class="o">)</span> <span class="o">{</span>
            <span class="k">case</span> <span class="s">"자기소개"</span><span class="o">:</span>
                <span class="n">Map</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span> <span class="n">String</span><span class="o">&gt;</span> <span class="n">intro</span> <span class="o">=</span> <span class="n">hashOperations</span><span class="o">.</span><span class="na">entries</span><span class="o">(</span><span class="s">"test:user:kingbbode"</span><span class="o">);</span>
                <span class="n">stringBuilder</span><span class="o">.</span><span class="na">append</span><span class="o">(</span><span class="s">"\n******자기소개********"</span><span class="o">);</span>
                <span class="n">stringBuilder</span><span class="o">.</span><span class="na">append</span><span class="o">(</span><span class="s">"\n이름은 "</span><span class="o">);</span>
                <span class="n">stringBuilder</span><span class="o">.</span><span class="na">append</span><span class="o">(</span><span class="n">intro</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="s">"name"</span><span class="o">));</span>
                <span class="n">stringBuilder</span><span class="o">.</span><span class="na">append</span><span class="o">(</span><span class="s">"\n나이는 "</span><span class="o">);</span>
                <span class="n">stringBuilder</span><span class="o">.</span><span class="na">append</span><span class="o">(</span><span class="n">intro</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="s">"age"</span><span class="o">));</span>
                <span class="k">break</span><span class="o">;</span>
            <span class="k">case</span> <span class="s">"취미소개"</span><span class="o">:</span>
                <span class="n">Set</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="n">hobbys</span> <span class="o">=</span> <span class="n">setOperations</span><span class="o">.</span><span class="na">members</span><span class="o">(</span><span class="s">"test:user:kingbbode:hobby"</span><span class="o">);</span>
                <span class="n">stringBuilder</span><span class="o">.</span><span class="na">append</span><span class="o">(</span><span class="s">"\n******취미소개******"</span><span class="o">);</span>
                <span class="n">stringBuilder</span><span class="o">.</span><span class="na">append</span><span class="o">(</span><span class="s">"취미는"</span><span class="o">);</span>
                <span class="k">for</span> <span class="o">(</span><span class="n">String</span> <span class="n">hobby</span> <span class="o">:</span> <span class="n">hobbys</span><span class="o">)</span> <span class="o">{</span>
                    <span class="n">stringBuilder</span><span class="o">.</span><span class="na">append</span><span class="o">(</span><span class="s">"\n"</span><span class="o">);</span>
                    <span class="n">stringBuilder</span><span class="o">.</span><span class="na">append</span><span class="o">(</span><span class="n">hobby</span><span class="o">);</span>
                <span class="o">}</span>
                <span class="k">break</span><span class="o">;</span>
            <span class="k">case</span> <span class="s">"소망소개"</span><span class="o">:</span>
                <span class="n">Set</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="n">wishes</span> <span class="o">=</span> <span class="n">zSetOperations</span><span class="o">.</span><span class="na">range</span><span class="o">(</span><span class="s">"test:user:kingbbode:wish"</span><span class="o">,</span> <span class="mi">0</span><span class="o">,</span> <span class="mi">2</span><span class="o">);</span>
                <span class="n">stringBuilder</span><span class="o">.</span><span class="na">append</span><span class="o">(</span><span class="s">"\n******소망소개******"</span><span class="o">);</span>
                <span class="kt">int</span> <span class="n">rank</span> <span class="o">=</span> <span class="mi">1</span><span class="o">;</span>
                <span class="k">for</span> <span class="o">(</span><span class="n">String</span> <span class="n">wish</span> <span class="o">:</span> <span class="n">wishes</span><span class="o">){</span>
                    <span class="n">stringBuilder</span><span class="o">.</span><span class="na">append</span><span class="o">(</span><span class="s">"\n"</span><span class="o">);</span>
                    <span class="n">stringBuilder</span><span class="o">.</span><span class="na">append</span><span class="o">(</span><span class="n">rank</span><span class="o">);</span>
                    <span class="n">stringBuilder</span><span class="o">.</span><span class="na">append</span><span class="o">(</span><span class="s">"등 "</span><span class="o">);</span>
                    <span class="n">stringBuilder</span><span class="o">.</span><span class="na">append</span><span class="o">(</span><span class="n">wish</span><span class="o">);</span>
                    <span class="n">rank</span><span class="o">++;</span>
                <span class="o">}</span>
                <span class="k">break</span><span class="o">;</span>
            <span class="k">case</span> <span class="s">"선임이직"</span><span class="o">:</span>
                <span class="n">stringBuilder</span><span class="o">.</span><span class="na">append</span><span class="o">(</span><span class="s">"\n!!! 믿었던 선임 이직"</span><span class="o">);</span>
                <span class="n">zSetOperations</span><span class="o">.</span><span class="na">incrementScore</span><span class="o">(</span><span class="s">"test:user:kingbbode:wish"</span><span class="o">,</span> <span class="s">"경력직 채용"</span><span class="o">,</span> <span class="o">-</span><span class="mi">1</span><span class="o">);</span>
                <span class="n">listOperations</span><span class="o">.</span><span class="na">rightPush</span><span class="o">(</span><span class="s">"test:task"</span><span class="o">,</span> <span class="s">"소망소개"</span><span class="o">);</span>
                <span class="k">break</span><span class="o">;</span>
            <span class="k">default</span><span class="o">:</span>
                <span class="n">stringBuilder</span><span class="o">.</span><span class="na">append</span><span class="o">(</span><span class="s">"nonone"</span><span class="o">);</span>

        <span class="o">}</span>
        <span class="n">task</span> <span class="o">=</span> <span class="n">listOperations</span><span class="o">.</span><span class="na">leftPop</span><span class="o">(</span><span class="s">"test:task"</span><span class="o">);</span>
    <span class="o">}</span>
    <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">stringBuilder</span><span class="o">.</span><span class="na">toString</span><span class="o">());</span>
<span class="o">}</span>
</code></pre>
</div>

<p><code class="highlighter-rouge">List</code>는 <code class="highlighter-rouge">Pop</code>를 통하여 좌측 노드부터 데이터를 꺼냈습니다. 데이터를 rightPush 했으므로 leftPop을 사용함으로써 Queue처럼 사용하고 있습니다.</p>

<p><code class="highlighter-rouge">Hash</code>는 <code class="highlighter-rouge">entries</code>를 통해 데이터를 Map 자료형으로 가져올 수 있습니다.</p>

<p><code class="highlighter-rouge">Set</code>의 Value 안의 값들을 member라고 합니다. 그래서 <code class="highlighter-rouge">members</code>를 통해 해당 Key의 값들을 Set 자료형으로 가져올 수 있습니다.</p>

<p><code class="highlighter-rouge">ZSet</code>은 range를 통해 정해진 Rank 범위의 데이터를 가져올 수 있습니다. score를 기준으로 오름차순으로 데이터를 정렬합니다.</p>

<p><code class="highlighter-rouge">선임이직</code>이라는 이벤트가 발생시, 경력직 채용의 score를 -1하여 rank를 높이도록 해두었습니다. <code class="highlighter-rouge">zset</code>의 <code class="highlighter-rouge">incrementScore</code>를 사용했습니다. 그리고 소망이 변경되었으니 소망을 한번 더 말해도록 task를 추가했습니다.</p>

<p>출력결과는 원하는 작업을 잘 수행해서 나옵니다!</p>

<p><img src="/images/2016/2016_12_04_Spring_Boot_Redis/result.jpeg" alt="결과" /></p>

<p><a href="https://github.com/kingbbode/spring-boot-redis">GitHub Source</a></p>

<hr />

<p><a href="https://redis.io/commands">Redis command 문서</a>에 redis가 어떤 command를 가지고 있는지 모두 나오며, Operation에서 제공해주는 메서드명이 모두 짐작 가능한 메서드이므로 문서를 잘 참고한다면 누구라도 사용하는데 무리가 없을 것 같습니다.</p>

<p>인기가 많기도 하며, 개인 프로젝트에서 사용하긴 했는데, Redis가 무엇이며, 장점이 무엇이며, 언제 써야하는 것인지를 잘 모르고 많이 썼던 것 같습니다. 이번 정리를 통해 Redis를 좀 더 알 것 같습니다! 아직 멀었지만..</p>

          </div>

          <div class="article-share">
            
            <a href="" title="Share on Twitter" onclick="window.open('https://twitter.com/home?status=Spring Boot에서 Redis 사용하기 - https://kingbbode.github.io/posts/spinrg-boot-redis by @kingbbode', 'newwindow', 'width=500, height=225'); return false;" data-turbolinks="false">
              <svg enable-background="new 0 0 128 128" width="15px" version="1.1" viewBox="0 0 128 128" xml:space="preserve" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><g id="_x37__stroke"><g id="Twitter"><rect clip-rule="evenodd" fill="none" fill-rule="evenodd" height="128" width="128"/><path clip-rule="evenodd" d="M128,23.294    c-4.703,2.142-9.767,3.59-15.079,4.237c5.424-3.328,9.587-8.606,11.548-14.892c-5.079,3.082-10.691,5.324-16.687,6.526    c-4.778-5.231-11.608-8.498-19.166-8.498c-14.493,0-26.251,12.057-26.251,26.927c0,2.111,0.225,4.16,0.676,6.133    C41.217,42.601,21.871,31.892,8.91,15.582c-2.261,3.991-3.554,8.621-3.554,13.552c0,9.338,4.636,17.581,11.683,22.412    c-4.297-0.131-8.355-1.356-11.901-3.359v0.331c0,13.051,9.053,23.937,21.074,26.403c-2.201,0.632-4.523,0.948-6.92,0.948    c-1.69,0-3.343-0.162-4.944-0.478c3.343,10.694,13.035,18.483,24.53,18.691c-8.986,7.227-20.315,11.533-32.614,11.533    c-2.119,0-4.215-0.123-6.266-0.37c11.623,7.627,25.432,12.088,40.255,12.088c48.309,0,74.717-41.026,74.717-76.612    c0-1.171-0.023-2.342-0.068-3.49C120.036,33.433,124.491,28.695,128,23.294" fill-rule="evenodd" id="Twitter_1_"/></g></g></svg>
            </a>
            <a href="" title="Share on Facebook" onclick="window.open('https://www.facebook.com/sharer/sharer.php?u=https://kingbbode.github.io/posts/spinrg-boot-redis', 'newwindow', 'width=500, height=500'); return false;" data-turbolinks="false">
              <svg enable-background="new 0 0 128 128" width="15px" version="1.1" viewBox="0 0 128 128" xml:space="preserve" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><g id="_x31__stroke"><g id="Facebook_1_"><rect fill="none" height="128" width="128"/><path clip-rule="evenodd" d="M68.369,128H7.065C3.162,128,0,124.836,0,120.935    V7.065C0,3.162,3.162,0,7.065,0h113.871C124.837,0,128,3.162,128,7.065v113.87c0,3.902-3.163,7.065-7.064,7.065H88.318V78.431    h16.638l2.491-19.318H88.318V46.78c0-5.593,1.553-9.404,9.573-9.404l10.229-0.004V20.094c-1.769-0.235-7.841-0.761-14.906-0.761    c-14.749,0-24.846,9.003-24.846,25.535v14.246H51.688v19.318h16.681V128z" fill-rule="evenodd" id="Facebook"/></g></g></svg>
            </a>
            <a href="" title="Share on Google+" onclick="window.open('https://plus.google.com/share?url=https://kingbbode.github.io/posts/spinrg-boot-redis', 'newwindow', 'width=550, height=400'); return false;" data-turbolinks="false">
              <svg enable-background="new 0 0 128 128" version="1.1" viewBox="0 0 128 128" width="20px" xml:space="preserve" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><g id="_x35__stroke"><g id="Google_Plus"><rect clip-rule="evenodd" fill="none" fill-rule="evenodd" height="128" width="128"/><path clip-rule="evenodd" d="M40.654,55.935v16.13    c0,0,15.619-0.021,21.979-0.021C59.189,82.5,53.834,88.194,40.654,88.194c-13.338,0-23.748-10.832-23.748-24.194    s10.41-24.194,23.748-24.194c7.052,0,11.607,2.483,15.784,5.944c3.344-3.35,3.065-3.828,11.573-11.877    c-7.222-6.586-16.822-10.6-27.357-10.6C18.201,23.273,0,41.507,0,64c0,22.493,18.201,40.727,40.654,40.727    c33.561,0,41.763-29.275,39.044-48.792H40.654z M113.912,56.742V42.628h-10.063v14.113H89.358v10.081h14.491v14.517h10.063V66.823    H128V56.742H113.912z" fill-rule="evenodd" id="Google_Plus_1_"/></g></g></svg>
            </a>
          </div>

          
        </article>
        <footer class="footer reveal">
  <p>
    <a href="/about" title="About me">Kingbbode</a>
  </p>
</footer>

      </div>
    </div>
  </main>
  <script type="text/javascript" src="/assets/vendor.js"></script>
<script type="text/javascript" src="/assets/application.js"></script>

<script src="https://ajax.googleapis.com/ajax/libs/webfont/1.6.16/webfont.js"></script>
<script>
  WebFont.load({
    google: {
      families: ['Cormorant Garamond:700', 'Lato:300,400,700']
    }
  });
</script>


  <script>
    window.ga=function(){ga.q.push(arguments)};ga.q=[];ga.l=+new Date;
    ga('create','UA-75876601-1','auto');ga('send','pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>


</body>
</html>
